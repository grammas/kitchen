{"version":3,"file":"npm.mongodb-stitch-browser-core.js","sources":["webpack:///npm.mongodb-stitch-browser-core.js"],"sourcesContent":["(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{50:function(t,e,n){\"use strict\";var r,o,i=n(2),c=(function(){}(),function(){}(),r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t){function e(e,n){return t.call(this,e,n)||this}return c(e,t),e.prototype.createApiKey=function(e){return t.prototype.createApiKey.call(this,e)},e.prototype.fetchApiKey=function(e){return t.prototype.fetchApiKey.call(this,e)},e.prototype.fetchApiKeys=function(){return t.prototype.fetchApiKeys.call(this)},e.prototype.deleteApiKey=function(e){return t.prototype.deleteApiKey.call(this,e)},e.prototype.enableApiKey=function(e){return t.prototype.enableApiKey.call(this,e)},e.prototype.disableApiKey=function(e){return t.prototype.disableApiKey.call(this,e)},e}(i.m);(o||(o={})).factory=new(function(){function t(){}return t.prototype.getClient=function(t,e,n){return new s(t,n)},t}());var u,a=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=function(t){function e(e,n){return t.call(this,i.E.DEFAULT_NAME,e,n)||this}return a(e,t),e.prototype.registerWithEmail=function(e,n){return t.prototype.registerWithEmailInternal.call(this,e,n)},e.prototype.confirmUser=function(e,n){return t.prototype.confirmUserInternal.call(this,e,n)},e.prototype.resendConfirmationEmail=function(e){return t.prototype.resendConfirmationEmailInternal.call(this,e)},e.prototype.resetPassword=function(e,n,r){return t.prototype.resetPasswordInternal.call(this,e,n,r)},e.prototype.sendResetPasswordEmail=function(e){return t.prototype.sendResetPasswordEmailInternal.call(this,e)},e}(i.n);(u||(u={})).factory=new(function(){function t(){}return t.prototype.getClient=function(t,e,n){return new p(e,n)},t}());var h,l=n(35),d=function(){function t(){}return t.prototype.roundTrip=function(t){var e=Object(l.a)(t.url,{body:t.body,headers:t.headers,method:t.method,mode:\"cors\"}),n=e.then(function(t){return t.text()});return Promise.all([e,n]).then(function(t){var e=t[0],n=t[1],r={};return e.headers.forEach(function(t,e){r[e]=t}),new i.t(r,e.status,n)})},t.prototype.stream=function(t,e,n){throw void 0===e&&(e=!0),new i.A(i.B.StreamingNotSupported)},t}(),f=function(){function t(t){this.suiteName=t}return t.prototype.get=function(t){return localStorage.getItem(this.getKey(t))},t.prototype.set=function(t,e){localStorage.setItem(this.getKey(t),e)},t.prototype.remove=function(t){localStorage.removeItem(this.getKey(t))},t.prototype.getKey=function(t){return\"__stitch.client.\"+this.suiteName+\".\"+t},t}(),v=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y=function(t){function e(e,n,r,o){var i=t.call(this,o)||this;return i.evtSrc=e,i.onOpenError=r,i.openedOnce=!1,i.evtSrc.onopen=function(t){n(i),i.openedOnce=!0},i.reset(),i}return v(e,t),e.prototype.open=function(){if(this.closed)throw new i.A(i.B.StreamClosed)},e.prototype.afterClose=function(){this.evtSrc.close()},e.prototype.onReconnect=function(t){this.evtSrc=t.evtSrc,this.reset(),this.events=t.events.concat(this.events)},e.prototype.reset=function(){var t=this;this.evtSrc.onmessage=function(e){t.events.push(new i.p(i.p.MESSAGE_EVENT,e.data)),t.poll()},this.evtSrc.onerror=function(e){return e instanceof MessageEvent?(t.lastErr=e.data,t.events.push(new i.p(i.D.ERROR_EVENT_NAME,t.lastErr)),t.close(),void t.poll()):t.openedOnce?(t.evtSrc.close(),void t.reconnect()):(t.close(),void t.onOpenError(new Error(\"event source failed to open and will not reconnect; check network log for more details\")))}},e}(i.g),w=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return w(e,t),e.prototype.stream=function(t,e,n){void 0===e&&(e=!0);var r=g({},t.headers);return r[i.s.ACCEPT]=i.h.TEXT_EVENT_STREAM,r[i.s.CONTENT_TYPE]=i.h.TEXT_EVENT_STREAM,Object(l.a)(t.url+\"&stitch_validate=true\",{body:t.body,headers:r,method:t.method,mode:\"cors\"}).then(function(e){var r={};return e.headers.forEach(function(t,e){r[e]=t}),e.status<200||e.status>=300?e.text().then(function(t){return Object(i.H)(new i.t(r,e.status,t))}):new Promise(function(e,r){return new y(new EventSource(t.url),function(t){return e(t)},function(t){return r(t)},n?function(){return n().then(function(t){return t})}:void 0)})})},e}(d),A=function(){function t(t){this.proxy=t}return t.prototype.callFunction=function(t,e,n){return this.proxy.callFunction(t,e,n)},t.prototype.streamFunction=function(t,e,n){return this.proxy.streamFunction(t,e,n)},t}(),m=n(51);!function(t){t.StitchError=\"_stitch_error\",t.State=\"_stitch_state\",t.UserAuth=\"_stitch_ua\",t.LinkUser=\"_stitch_link_user\",t.StitchLink=\"_stitch_link\",t.ClientAppId=\"_stitch_client_app_id\"}(h||(h={}));var b,R=h;!function(t){t.ProviderName=\"_stitch_redirect_provider_name\",t.ProviderType=\"_stitch_redirect_provider_type\",t.State=\"_stitch_redirect_state\"}(b||(b={}));var E=b,O=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),I=function(t){function e(e){return t.call(this,e)||this}return O(e,t),e}(i.C),U=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),C=function(t){function e(e,n,r,o,i,c,s){var u=t.call(this,e,n,r,o,i,c)||this;return u.auth=s,u}return U(e,t),e.prototype.linkWithCredential=function(t){return this.auth.linkWithCredential(this,t)},e.prototype.linkUserWithRedirect=function(t){return this.auth.linkWithRedirectInternal(this,t)},e}(i.l),S=function(){function t(t){this.auth=t}return t.prototype.makeUser=function(t,e,n,r,o,i){return new C(t,e,n,r,o,i,this.auth)},t}(),P=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),k=function(t,e){var n=\"function\"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),c=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)c.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return c},j=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",L=function(t){function e(e,n,r,o,i){void 0===i&&(i=window);var c=t.call(this,e,n,r)||this;return c.browserAuthRoutes=n,c.authStorage=r,c.appInfo=o,c.jsdomWindow=i,c.listeners=new Set,c.synchronousListeners=new Set,c}return P(e,t),Object.defineProperty(e.prototype,\"userFactory\",{get:function(){return new S(this)},enumerable:!0,configurable:!0}),e.prototype.getProviderClient=function(t,e){return function(t){return void 0!==t.getClient}(t)?t.getClient(this,this.requestClient,this.authRoutes):t.getNamedClient(e,this.requestClient,this.authRoutes)},e.prototype.loginWithCredential=function(e){return t.prototype.loginWithCredentialInternal.call(this,e)},e.prototype.loginWithRedirect=function(t){var e=this,n=this.prepareRedirect(t),r=n.redirectUrl,o=n.state;this.requestClient.getBaseURL().then(function(n){e.jsdomWindow.location.replace(n+e.browserAuthRoutes.getAuthProviderRedirectRoute(t,r,o,e.deviceInfo))})},e.prototype.linkWithRedirectInternal=function(t,n){var r=this;if(void 0!==this.user&&t.id!==this.user.id)return Promise.reject(new i.A(i.B.UserNoLongerValid));var o=this.prepareRedirect(n),c=o.redirectUrl,s=o.state;return this.requestClient.getBaseURL().then(function(t){var o=t+r.browserAuthRoutes.getAuthProviderLinkRedirectRoute(n,c,s,r.deviceInfo);return(e.injectedFetch?e.injectedFetch:fetch)(new Request(o,{credentials:\"include\",headers:{Authorization:\"Bearer \"+r.authInfo.accessToken},mode:\"cors\"}))}).then(function(t){r.jsdomWindow.location.replace(t.headers.get(\"X-Stitch-Location\"))})},e.prototype.hasRedirectResult=function(){var t=!1;try{return t=this.parseRedirect().isValid}catch(t){return!1}finally{t||this.cleanupRedirect()}},e.prototype.handleRedirectResult=function(){try{var t=this.authStorage.get(E.ProviderName),e=this.authStorage.get(E.ProviderType),n=this.parseRedirect();return this.loginWithCredentialInternal(new i.z(this.processRedirectResult(n),e,t,n.asLink)).then(function(t){return t})}catch(t){return Promise.reject(t)}},e.prototype.linkWithCredential=function(e,n){return t.prototype.linkUserWithCredentialInternal.call(this,e,n)},e.prototype.logout=function(){return arguments.length>0?Promise.reject(new i.A(i.B.UnexpectedArguments)):t.prototype.logoutInternal.call(this)},e.prototype.logoutUserWithId=function(e){return t.prototype.logoutUserWithIdInternal.call(this,e)},e.prototype.removeUser=function(){return arguments.length>0?Promise.reject(new i.A(i.B.UnexpectedArguments)):t.prototype.removeUserInternal.call(this)},e.prototype.removeUserWithId=function(e){return t.prototype.removeUserWithIdInternal.call(this,e)},Object.defineProperty(e.prototype,\"deviceInfo\",{get:function(){var t={};this.hasDeviceId&&(t[i.o.DEVICE_ID]=this.deviceId),void 0!==this.appInfo.localAppName&&(t[i.o.APP_ID]=this.appInfo.localAppName),void 0!==this.appInfo.localAppVersion&&(t[i.o.APP_VERSION]=this.appInfo.localAppVersion);var e=Object(m.detect)();return e?(t[i.o.PLATFORM]=e.name,t[i.o.PLATFORM_VERSION]=e.version):(t[i.o.PLATFORM]=\"web\",t[i.o.PLATFORM_VERSION]=\"0.0.0\"),t[i.o.SDK_VERSION]=\"4.3.2\",t},enumerable:!0,configurable:!0}),e.prototype.addAuthListener=function(t){this.listeners.add(t),this.onAuthEvent(t),this.dispatchAuthEvent({kind:i.c.ListenerRegistered})},e.prototype.addSynchronousAuthListener=function(t){this.listeners.add(t),this.onAuthEvent(t),this.dispatchAuthEvent({kind:i.c.ListenerRegistered})},e.prototype.removeAuthListener=function(t){this.listeners.delete(t)},e.prototype.onAuthEvent=function(t){var e=this;if(t)new Promise(function(n){t.onAuthEvent&&t.onAuthEvent(e),n(void 0)});else this.listeners.forEach(function(t){e.onAuthEvent(t)})},e.prototype.dispatchAuthEvent=function(t){var e=this;switch(t.kind){case i.c.ActiveUserChanged:this.dispatchBlockToListeners(function(n){n.onActiveUserChanged&&n.onActiveUserChanged(e,t.currentActiveUser,t.previousActiveUser)});break;case i.c.ListenerRegistered:this.dispatchBlockToListeners(function(t){t.onListenerRegistered&&t.onListenerRegistered(e)});break;case i.c.UserAdded:this.dispatchBlockToListeners(function(n){n.onUserAdded&&n.onUserAdded(e,t.addedUser)});break;case i.c.UserLinked:this.dispatchBlockToListeners(function(n){n.onUserLinked&&n.onUserLinked(e,t.linkedUser)});break;case i.c.UserLoggedIn:this.dispatchBlockToListeners(function(n){n.onUserLoggedIn&&n.onUserLoggedIn(e,t.loggedInUser)});break;case i.c.UserLoggedOut:this.dispatchBlockToListeners(function(n){n.onUserLoggedOut&&n.onUserLoggedOut(e,t.loggedOutUser)});break;case i.c.UserRemoved:this.dispatchBlockToListeners(function(n){n.onUserRemoved&&n.onUserRemoved(e,t.removedUser)});break;default:return this.assertNever(t)}},e.prototype.assertNever=function(t){throw new Error(\"unexpected object: \"+t)},e.prototype.dispatchBlockToListeners=function(t){this.synchronousListeners.forEach(t),this.listeners.forEach(function(e){new Promise(function(n){t(e),n(void 0)})})},e.prototype.cleanupRedirect=function(){this.jsdomWindow.history.replaceState(null,\"\",this.pageRootUrl()),this.authStorage.remove(E.State),this.authStorage.remove(E.ProviderName),this.authStorage.remove(E.ProviderType)},e.prototype.parseRedirect=function(){if(void 0===this.jsdomWindow)throw new I(\"running in a non-browser environment\");if(!this.jsdomWindow.location||!this.jsdomWindow.location.hash)throw new I(\"window location hash was undefined\");var t=this.authStorage.get(E.State);return function(t,e,n){var r=t.split(\"&\"),o=new T;return r.forEach(function(t){var r=t.split(\"=\");switch(decodeURIComponent(r[0])){case R.StitchError:o.lastError=decodeURIComponent(r[1]);break;case R.UserAuth:try{o.authInfo=function(t){var e=t.split(\"$\");if(4!==e.length)throw new I(\"invalid user auth data provided while marshalling user authentication data: \"+t);var n=k(e,4),r=n[0],o=n[1],c=n[2],s=n[3];return new i.d(c,s,r,o)}(decodeURIComponent(r[1]))}catch(t){o.lastError=t}break;case R.StitchLink:\"ok\"===r[1]&&(o.asLink=!0);break;case R.State:var c=decodeURIComponent(r[1]);e===c&&(o.stateValid=!0);break;case R.ClientAppId:var s=decodeURIComponent(r[1]);n===s&&(o.clientAppIdValid=!0)}}),o}(this.jsdomWindow.location.hash.substring(1),t,this.appInfo.clientAppId)},e.prototype.processRedirectResult=function(t){try{if(!t.isValid)throw new I(\"invalid redirect result\");if(t.lastError)throw new I(\"error handling redirect: \"+t.lastError);if(!t.authInfo)throw new I(\"no user auth value was found: it could not be decoded from fragment\")}catch(t){throw t}finally{this.cleanupRedirect()}return t.authInfo},e.prototype.prepareRedirect=function(t){this.authStorage.set(E.ProviderName,t.providerName),this.authStorage.set(E.ProviderType,t.providerType);var e=t.redirectUrl;void 0===e&&(e=this.pageRootUrl());var n=function(){for(var t=\"\",e=0;e<64;++e)t+=j.charAt(Math.floor(Math.random()*j.length));return t}();return this.authStorage.set(E.State,n),{redirectUrl:e,state:n}},e.prototype.pageRootUrl=function(){return[this.jsdomWindow.location.protocol,\"//\",this.jsdomWindow.location.host,this.jsdomWindow.location.pathname].join(\"\")},e}(i.j);var T=function(){function t(){this.stateValid=!1,this.clientAppIdValid=!1,this.asLink=!1}return Object.defineProperty(t.prototype,\"isValid\",{get:function(){return this.stateValid&&this.clientAppIdValid},enumerable:!0,configurable:!0}),t}();var N=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),W=function(t){function e(e){return t.call(this,e)||this}return N(e,t),e.prototype.getAuthProviderRedirectRoute=function(t,e,n,r){return this.getAuthProviderLoginRoute(t.providerName)+\"?redirect=\"+encodeURI(e)+\"&state=\"+n+\"&device=\"+this.uriEncodeObject(r)},e.prototype.getAuthProviderLinkRedirectRoute=function(t,e,n,r){return this.getAuthProviderLoginRoute(t.providerName)+\"?redirect=\"+encodeURI(e)+\"&state=\"+n+\"&device=\"+this.uriEncodeObject(r)+\"&link=true&providerRedirectHeader=true\"},e.prototype.uriEncodeObject=function(t){return encodeURIComponent(Object(i.G)(JSON.stringify(t)))},e}(i.u),V=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),B=function(t){function e(e){var n=t.call(this,e)||this;return n.authRoutes=new W(e),n}return V(e,t),e}(i.y),K=function(){function t(t,e){this.info=new i.w(t,e.dataDirectory,e.localAppName,e.localAppVersion),this.routes=new B(this.info.clientAppId);var n=new i.x(t,e.baseUrl,e.transport);this.auth=new L(n,this.routes.authRoutes,e.storage,this.info),this.coreClient=new i.i(this.auth,this.routes),this.serviceClients=[],this.auth.addSynchronousAuthListener(this)}return t.prototype.getServiceClient=function(t,e){if(function(t){return void 0!==t.getClient}(t)){var n=new i.k(this.auth,this.routes.serviceRoutes,\"\");return this.bindServiceClient(n),t.getClient(n,this.info)}n=new i.k(this.auth,this.routes.serviceRoutes,e);return this.bindServiceClient(n),t.getNamedClient(n,this.info)},t.prototype.getGeneralServiceClient=function(t){var e=new i.k(this.auth,this.routes.serviceRoutes,t);return this.bindServiceClient(e),new A(e)},t.prototype.callFunction=function(t,e){return this.coreClient.callFunction(t,e)},t.prototype.onActiveUserChanged=function(t,e,n){this.onRebindEvent(new i.e({currentActiveUser:e,kind:i.c.ActiveUserChanged,previousActiveUser:n}))},t.prototype.bindServiceClient=function(t){this.serviceClients.push(t)},t.prototype.onRebindEvent=function(t){this.serviceClients.forEach(function(e){e.onRebindEvent(t)})},t}();var F={},M=function(){function t(){}return Object.defineProperty(t,\"defaultAppClient\",{get:function(){if(void 0===t.defaultClientAppId)throw new Error(\"default app client has not yet been initialized/set\");return F[t.defaultClientAppId]},enumerable:!0,configurable:!0}),t.getAppClient=function(t){if(void 0===F[t])throw new Error(\"client for app '\"+t+\"' has not yet been initialized\");return F[t]},t.hasAppClient=function(t){return void 0!==F[t]},t.initializeDefaultAppClient=function(e,n){if(void 0===n&&(n=(new i.v.Builder).build()),void 0===e||\"\"===e)throw new Error(\"clientAppId must be set to a non-empty string\");if(void 0!==t.defaultClientAppId)throw new Error(\"default app can only be set once; currently set to '\"+t.defaultClientAppId+\"'\");var r=t.initializeAppClient(e,n);return t.defaultClientAppId=e,r},t.initializeAppClient=function(e,n){if(void 0===n&&(n=(new i.v.Builder).build()),void 0===e||\"\"===e)throw new Error(\"clientAppId must be set to a non-empty string\");if(void 0!==F[e])throw new Error(\"client for app '\"+e+\"' has already been initialized\");var r=n.builder?n.builder():new i.v.Builder(n);void 0===r.storage&&r.withStorage(new f(e)),void 0===r.transport&&(window.EventSource?r.withTransport(new _):r.withTransport(new d)),void 0!==r.baseUrl&&\"\"!==r.baseUrl||r.withBaseUrl(\"https://stitch.mongodb.com\"),void 0!==r.localAppName&&\"\"!==r.localAppName||r.withLocalAppName(t.localAppName),void 0!==r.localAppVersion&&\"\"!==r.localAppVersion||r.withLocalAppVersion(t.localAppVersion);var o=new K(e,r.build());return F[e]=o,o},t.clearApps=function(){F={}},t}();n.d(e,\"a\",function(){return i.a}),n.d(e,\"b\",function(){return i.f}),n.d(e,\"c\",function(){return M}),n.d(e,\"d\",function(){return i.v}),n.d(e,\"e\",function(){return u}),n.d(e,\"f\",function(){return i.F})}}]);"],"mappings":"AAAA","sourceRoot":""}