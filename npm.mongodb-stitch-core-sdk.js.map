{"version":3,"file":"npm.mongodb-stitch-core-sdk.js","sources":["webpack:///npm.mongodb-stitch-core-sdk.js"],"sourcesContent":["(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{2:function(t,e,r){\"use strict\";var n,o=r(5);!function(t){t[t.ActiveUserChanged=0]=\"ActiveUserChanged\",t[t.ListenerRegistered=1]=\"ListenerRegistered\",t[t.UserAdded=2]=\"UserAdded\",t[t.UserLinked=3]=\"UserLinked\",t[t.UserLoggedIn=4]=\"UserLoggedIn\",t[t.UserLoggedOut=5]=\"UserLoggedOut\",t[t.UserRemoved=6]=\"UserRemoved\"}(n||(n={}));var i,s=function(){function t(t,e,r,n,o,i,s,u){this.userId=t,this.deviceId=e,this.accessToken=r,this.refreshToken=n,this.loggedInProviderType=o,this.loggedInProviderName=i,this.lastAuthActivity=s,this.userProfile=u}return t.empty=function(){return new t(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)},Object.defineProperty(t.prototype,\"hasUser\",{get:function(){return void 0!==this.userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"isEmpty\",{get:function(){return void 0===this.deviceId},enumerable:!0,configurable:!0}),t.prototype.loggedOut=function(){return new t(this.userId,this.deviceId,void 0,void 0,this.loggedInProviderType,this.loggedInProviderName,new Date,this.userProfile)},t.prototype.withClearedUser=function(){return new t(void 0,this.deviceId,void 0,void 0,void 0,void 0,void 0,void 0)},t.prototype.withAuthProvider=function(e,r){return new t(this.userId,this.deviceId,this.accessToken,this.refreshToken,e,r,new Date,this.userProfile)},t.prototype.withNewAuthActivityTime=function(){return new t(this.userId,this.deviceId,this.accessToken,this.refreshToken,this.loggedInProviderType,this.loggedInProviderName,new Date,this.userProfile)},Object.defineProperty(t.prototype,\"isLoggedIn\",{get:function(){return void 0!==this.accessToken&&void 0!==this.refreshToken},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){return new t(void 0===e.userId?this.userId:e.userId,void 0===e.deviceId?this.deviceId:e.deviceId,void 0===e.accessToken?this.accessToken:e.accessToken,void 0===e.refreshToken?this.refreshToken:e.refreshToken,void 0===e.loggedInProviderType?this.loggedInProviderType:e.loggedInProviderType,void 0===e.loggedInProviderName?this.loggedInProviderName:e.loggedInProviderName,void 0===e.lastAuthActivity?this.lastAuthActivity:e.lastAuthActivity,void 0===e.userProfile?this.userProfile:e.userProfile)},t}(),u=(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=function(t){Error.call(this,t),Error.captureStackTrace&&Error.captureStackTrace(this),this.message=t,this.name=this.constructor.name};a.prototype=Object.create(Error.prototype);var c,h,d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e}(a);!function(t){t[t.TRANSPORT_ERROR=0]=\"TRANSPORT_ERROR\",t[t.DECODING_ERROR=1]=\"DECODING_ERROR\",t[t.ENCODING_ERROR=2]=\"ENCODING_ERROR\"}(h||(h={}));var f,p=((c={})[h.TRANSPORT_ERROR]=\"the request transport encountered an error communicating with Stitch\",c[h.DECODING_ERROR]=\"an error occurred while decoding a response from Stitch\",c[h.ENCODING_ERROR]=\"an error occurred while encoding a request for Stitch\",c),l=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),v=function(t){function e(e,r){var n=this,o=\"(\"+h[r]+\"): \"+p[r]+\": \"+e.message;return(n=t.call(this,o)||this).underlyingError=e,n.errorCode=r,n.errorCodeName=h[r],n}return l(e,t),e}(d);!function(t){t[t.MissingAuthReq=0]=\"MissingAuthReq\",t[t.InvalidSession=1]=\"InvalidSession\",t[t.UserAppDomainMismatch=2]=\"UserAppDomainMismatch\",t[t.DomainNotAllowed=3]=\"DomainNotAllowed\",t[t.ReadSizeLimitExceeded=4]=\"ReadSizeLimitExceeded\",t[t.InvalidParameter=5]=\"InvalidParameter\",t[t.MissingParameter=6]=\"MissingParameter\",t[t.TwilioError=7]=\"TwilioError\",t[t.GCMError=8]=\"GCMError\",t[t.HTTPError=9]=\"HTTPError\",t[t.AWSError=10]=\"AWSError\",t[t.MongoDBError=11]=\"MongoDBError\",t[t.ArgumentsNotAllowed=12]=\"ArgumentsNotAllowed\",t[t.FunctionExecutionError=13]=\"FunctionExecutionError\",t[t.NoMatchingRuleFound=14]=\"NoMatchingRuleFound\",t[t.InternalServerError=15]=\"InternalServerError\",t[t.AuthProviderNotFound=16]=\"AuthProviderNotFound\",t[t.AuthProviderAlreadyExists=17]=\"AuthProviderAlreadyExists\",t[t.ServiceNotFound=18]=\"ServiceNotFound\",t[t.ServiceTypeNotFound=19]=\"ServiceTypeNotFound\",t[t.ServiceAlreadyExists=20]=\"ServiceAlreadyExists\",t[t.ServiceCommandNotFound=21]=\"ServiceCommandNotFound\",t[t.ValueNotFound=22]=\"ValueNotFound\",t[t.ValueAlreadyExists=23]=\"ValueAlreadyExists\",t[t.ValueDuplicateName=24]=\"ValueDuplicateName\",t[t.FunctionNotFound=25]=\"FunctionNotFound\",t[t.FunctionAlreadyExists=26]=\"FunctionAlreadyExists\",t[t.FunctionDuplicateName=27]=\"FunctionDuplicateName\",t[t.FunctionSyntaxError=28]=\"FunctionSyntaxError\",t[t.FunctionInvalid=29]=\"FunctionInvalid\",t[t.IncomingWebhookNotFound=30]=\"IncomingWebhookNotFound\",t[t.IncomingWebhookAlreadyExists=31]=\"IncomingWebhookAlreadyExists\",t[t.IncomingWebhookDuplicateName=32]=\"IncomingWebhookDuplicateName\",t[t.RuleNotFound=33]=\"RuleNotFound\",t[t.ApiKeyNotFound=34]=\"ApiKeyNotFound\",t[t.RuleAlreadyExists=35]=\"RuleAlreadyExists\",t[t.RuleDuplicateName=36]=\"RuleDuplicateName\",t[t.AuthProviderDuplicateName=37]=\"AuthProviderDuplicateName\",t[t.RestrictedHost=38]=\"RestrictedHost\",t[t.ApiKeyAlreadyExists=39]=\"ApiKeyAlreadyExists\",t[t.IncomingWebhookAuthFailed=40]=\"IncomingWebhookAuthFailed\",t[t.ExecutionTimeLimitExceeded=41]=\"ExecutionTimeLimitExceeded\",t[t.FunctionNotCallable=42]=\"FunctionNotCallable\",t[t.UserAlreadyConfirmed=43]=\"UserAlreadyConfirmed\",t[t.UserNotFound=44]=\"UserNotFound\",t[t.UserDisabled=45]=\"UserDisabled\",t[t.Unknown=46]=\"Unknown\"}(f||(f={}));var y={APIKeyAlreadyExists:f.ApiKeyAlreadyExists,APIKeyNotFound:f.ApiKeyNotFound,AWSError:f.AWSError,ArgumentsNotAllowed:f.ArgumentsNotAllowed,AuthProviderAlreadyExists:f.AuthProviderAlreadyExists,AuthProviderDuplicateName:f.AuthProviderDuplicateName,AuthProviderNotFound:f.AuthProviderNotFound,DomainNotAllowed:f.DomainNotAllowed,ExecutionTimeLimitExceeded:f.ExecutionTimeLimitExceeded,FunctionAlreadyExists:f.FunctionAlreadyExists,FunctionDuplicateName:f.FunctionDuplicateName,FunctionExecutionError:f.FunctionExecutionError,FunctionInvalid:f.FunctionInvalid,FunctionNotCallable:f.FunctionNotCallable,FunctionNotFound:f.FunctionNotFound,FunctionSyntaxError:f.FunctionSyntaxError,GCMError:f.GCMError,HTTPError:f.HTTPError,IncomingWebhookAlreadyExists:f.IncomingWebhookAlreadyExists,IncomingWebhookAuthFailed:f.IncomingWebhookAuthFailed,IncomingWebhookDuplicateName:f.IncomingWebhookDuplicateName,IncomingWebhookNotFound:f.IncomingWebhookNotFound,InternalServerError:f.InternalServerError,InvalidParameter:f.InvalidParameter,InvalidSession:f.InvalidSession,MissingAuthReq:f.MissingAuthReq,MissingParameter:f.MissingParameter,MongoDBError:f.MongoDBError,NoMatchingRuleFound:f.NoMatchingRuleFound,ReadSizeLimitExceeded:f.ReadSizeLimitExceeded,RestrictedHost:f.RestrictedHost,RuleAlreadyExists:f.RuleAlreadyExists,RuleDuplicateName:f.RuleDuplicateName,RuleNotFound:f.RuleNotFound,ServiceAlreadyExists:f.ServiceAlreadyExists,ServiceCommandNotFound:f.ServiceCommandNotFound,ServiceNotFound:f.ServiceNotFound,ServiceTypeNotFound:f.ServiceTypeNotFound,TwilioError:f.TwilioError,UserAlreadyConfirmed:f.UserAlreadyConfirmed,UserAppDomainMismatch:f.UserAppDomainMismatch,UserDisabled:f.UserDisabled,UserNotFound:f.UserNotFound,ValueAlreadyExists:f.ValueAlreadyExists,ValueDuplicateName:f.ValueDuplicateName,ValueNotFound:f.ValueNotFound};function E(t){return t in y?y[t]:f.Unknown}var A,m,g=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),R=function(t){function e(e,r){void 0===r&&(r=f.Unknown);var n=t.call(this,e)||this;return n.message=e,n.errorCode=r,n.errorCodeName=f[r],n}return g(e,t),e}(d),I=function(){function t(){}return t.APPLICATION_JSON=\"application/json\",t.TEXT_EVENT_STREAM=\"text/event-stream\",t}(),T=function(){function t(){}return t.getAuthorizationBearer=function(e){return t.AUTHORIZATION_BEARER+\" \"+e},t.CONTENT_TYPE_CANON=\"Content-Type\",t.CONTENT_TYPE=t.CONTENT_TYPE_CANON.toLocaleLowerCase(),t.AUTHORIZATION_CANON=\"Authorization\",t.AUTHORIZATION=t.AUTHORIZATION_CANON.toLocaleLowerCase(),t.ACCEPT_CANON=\"Accept\",t.ACCEPT=t.ACCEPT_CANON.toLocaleLowerCase(),t.AUTHORIZATION_BEARER=\"Bearer\",t}();function w(t){return t instanceof d?t:new v(t,h.DECODING_ERROR)}function _(t){if(void 0===t.body)throw new R(\"received unexpected status code \"+t.statusCode,f.Unknown);var e;try{e=t.body}catch(e){throw new R(\"received unexpected status code \"+t.statusCode,f.Unknown)}var r=function(t,e){if(void 0===t.headers[T.CONTENT_TYPE]||void 0!==t.headers[T.CONTENT_TYPE]&&t.headers[T.CONTENT_TYPE]!==I.APPLICATION_JSON)return e;var r=JSON.parse(e);if(!(r instanceof Object))return e;var n=r;if(void 0===n[A.ERROR])return e;var o=n[A.ERROR];if(void 0===n[A.ERROR_CODE])return o;var i=n[A.ERROR_CODE];throw new R(o,E(i))}(t,e);throw new R(r,f.Unknown)}!function(t){t.ERROR=\"error\",t.ERROR_CODE=\"error_code\"}(A||(A={})),function(t){t.GET=\"GET\",t.POST=\"POST\",t.PUT=\"PUT\",t.DELETE=\"DELETE\",t.HEAD=\"HEAD\",t.OPTIONS=\"OPTIONS\",t.TRACE=\"TRACE\",t.PATCH=\"PATCH\"}(m||(m={}));var N=m,O=function(){function t(t,e,r,n,o){this.method=t,this.path=e,this.headers=r,this.body=o,this.startedAt=n}return Object.defineProperty(t.prototype,\"builder\",{get:function(){return new t.Builder(this)},enumerable:!0,configurable:!0}),t}();!function(t){var e=function(){function e(t){void 0!==t&&(this.method=t.method,this.path=t.path,this.headers=t.headers,this.body=t.body,this.startedAt=t.startedAt)}return e.prototype.withMethod=function(t){return this.method=t,this},e.prototype.withPath=function(t){return this.path=t,this},e.prototype.withHeaders=function(t){return this.headers=t,this},e.prototype.withBody=function(t){return this.body=t,this},e.prototype.build=function(){if(void 0===this.method)throw Error(\"must set method\");if(void 0===this.path)throw Error(\"must set non-empty path\");return void 0===this.startedAt&&(this.startedAt=Date.now()/1e3),new t(this.method,this.path,void 0===this.headers?{}:this.headers,this.startedAt,this.body)},e}();t.Builder=e}(O||(O={}));var P,b,U=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),S=function(t){function e(e,r,n){void 0===r&&(r=!1),void 0===n&&(n=!0);var o=t.call(this,e.method,e.path,e.headers,e.startedAt,e.body)||this;return o.useRefreshToken=r,o.shouldRefreshOnFailure=n,o}return U(e,t),Object.defineProperty(e.prototype,\"builder\",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(O);P=S||(S={}),b=function(t){function e(e){return t.call(this,e)||this}return U(e,t),e.prototype.withAccessToken=function(){return this.useRefreshToken=!1,this},e.prototype.withRefreshToken=function(){return this.useRefreshToken=!0,this},e.prototype.withShouldRefreshOnFailure=function(t){return this.shouldRefreshOnFailure=t,this},e.prototype.build=function(){return this.useRefreshToken&&(this.shouldRefreshOnFailure=!1),new P(t.prototype.build.call(this),this.useRefreshToken,this.shouldRefreshOnFailure)},e}(O.Builder),P.Builder=b;var D=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),C=function(t){function e(e,r){var n=this;return(n=e instanceof S?t.call(this,e,e.useRefreshToken,e.shouldRefreshOnFailure)||this:t.call(this,e)||this).document=r,n}return D(e,t),Object.defineProperty(e.prototype,\"builder\",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(S);!function(t){var e=function(e){function r(t){var r=e.call(this,t)||this;return void 0!==t&&(r.document=t.document,r.useRefreshToken=t.useRefreshToken),r}return D(r,e),r.prototype.withDocument=function(t){return this.document=t,this},r.prototype.withAccessToken=function(){return this.useRefreshToken=!1,this},r.prototype.build=function(){if(void 0===this.document||!(this.document instanceof Object))throw new Error(\"document must be set: \"+this.document);return void 0===this.headers&&this.withHeaders({}),this.headers[T.CONTENT_TYPE]=I.APPLICATION_JSON,this.withBody(o.a.stringify(this.document,{relaxed:!1})),new t(e.prototype.build.call(this),this.document)},r}(S.Builder);t.Builder=e}(C||(C={}));var k,L,F=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),M=function(t){function e(e,r){var n=t.call(this,e.method,e.path,e.headers,e.startedAt,e.body)||this;return n.document=r,n}return F(e,t),Object.defineProperty(e.prototype,\"builder\",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(O);!function(t){var e=function(e){function r(t){var r=e.call(this,t)||this;return void 0!==t&&(r.document=t.document),r}return F(r,e),r.prototype.withDocument=function(t){return this.document=t,this},r.prototype.build=function(){if(void 0===this.document||!(this.document instanceof Object))throw new Error(\"document must be set\");return void 0===this.headers&&this.withHeaders({}),this.headers[T.CONTENT_TYPE]=I.APPLICATION_JSON,this.withBody(o.a.stringify(this.document,{relaxed:!1})),new t(e.prototype.build.call(this),this.document)},r}(O.Builder);t.Builder=e}(M||(M={})),function(t){t[t.LoggedOutDuringRequest=0]=\"LoggedOutDuringRequest\",t[t.MustAuthenticateFirst=1]=\"MustAuthenticateFirst\",t[t.UserNoLongerValid=2]=\"UserNoLongerValid\",t[t.UserNotFound=3]=\"UserNotFound\",t[t.UserNotLoggedIn=4]=\"UserNotLoggedIn\",t[t.CouldNotLoadPersistedAuthInfo=5]=\"CouldNotLoadPersistedAuthInfo\",t[t.CouldNotPersistAuthInfo=6]=\"CouldNotPersistAuthInfo\",t[t.StreamingNotSupported=7]=\"StreamingNotSupported\",t[t.StreamClosed=8]=\"StreamClosed\",t[t.UnexpectedArguments=9]=\"UnexpectedArguments\"}(L||(L={}));var x,j=((k={})[L.LoggedOutDuringRequest]=\"logged out while making a request to Stitch\",k[L.MustAuthenticateFirst]=\"method called requires being authenticated\",k[L.UserNoLongerValid]=\"user instance being accessed is no longer valid; please get a new user with auth.getUser()\",k[L.UserNotFound]=\"user not found in list of users\",k[L.UserNotLoggedIn]=\"cannot make the active user a logged out user; please use loginWithCredential() to switch to this user\",k[L.CouldNotLoadPersistedAuthInfo]=\"failed to load stored auth information for Stitch\",k[L.CouldNotPersistAuthInfo]=\"failed to save auth information for Stitch\",k[L.StreamingNotSupported]=\"streaming not supported in this SDK\",k[L.StreamClosed]=\"stream is closed\",k[L.UnexpectedArguments]=\"function does not accept arguments\",k),q=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),V=function(t){function e(e){var r=this,n=\"(\"+L[e]+\"): \"+j[e];return(r=t.call(this,n)||this).errorCode=e,r.errorCodeName=L[e],r}return q(e,t),e}(d),B=function(){function t(t,e){this.eventName=t,this.data=e}return t.MESSAGE_EVENT=\"message\",t}(),K=function(){function t(e,r,n){this.eventName=e,r=r||\"\";for(var i=[],s=0;s<r.length;s++){var u=r[s];switch(u){case\"%\":if(s+2>=r.length)break;var a=void 0;switch(r.substring(s+1,s+3)){case\"25\":a=!0,i.push(\"%\");break;case\"0A\":a=!0,i.push(\"\\n\");break;case\"0D\":a=!0,i.push(\"\\r\");break;default:a=!1}if(a){s+=2;continue}}i.push(u)}var c=i.join(\"\");switch(this.eventName){case t.ERROR_EVENT_NAME:var h=void 0,d=void 0;try{var p=o.a.parse(c,{strict:!1});h=p[x.Error],d=E(p[x.ErrorCode])}catch(t){h=c,d=f.Unknown}this.error=new R(h,d);break;case B.MESSAGE_EVENT:this.data=o.a.parse(c,{strict:!1}),n&&(this.data=n.decode(this.data))}}return t.fromEvent=function(e,r){return new t(e.eventName,e.data,r)},t.ERROR_EVENT_NAME=\"error\",t}();!function(t){t.Error=\"error\",t.ErrorCode=\"error_code\"}(x||(x={}));var G=function(){function t(t,e){this.eventStream=t,this.decoder=e,this.listeners=[]}return t.prototype.next=function(){var t=this;return this.eventStream.nextEvent().then(function(e){var r=K.fromEvent(e,t.decoder);if(r.eventName===K.ERROR_EVENT_NAME)throw r.error;return r.eventName===B.MESSAGE_EVENT?r.data:t.next()})},t.prototype.onNext=function(t){var e=this,r={onEvent:function(r){var n=K.fromEvent(r,e.decoder);n.eventName===B.MESSAGE_EVENT&&t(n.data)}};this.eventStream.addListener(r)},t.prototype.onError=function(t){var e=this,r={onEvent:function(r){var n=K.fromEvent(r,e.decoder);n.eventName===K.ERROR_EVENT_NAME&&t(n.error)}};this.eventStream.addListener(r)},t.prototype.addListener=function(t){var e=this,r={onEvent:function(r){var n=K.fromEvent(r,e.decoder);n.eventName===K.ERROR_EVENT_NAME?t.onError&&t.onError(n.error):t.onNext&&t.onNext(n.data)}};this.listeners.push([t,r]),this.eventStream.addListener(r)},t.prototype.removeListener=function(t){for(var e=-1,r=0;r<this.listeners.length;r++)if(this.listeners[r][0]===t){e=r;break}if(-1!==e){var n=this.listeners[e][1];this.listeners.splice(e,1),this.eventStream.removeListener(n)}},t.prototype.isOpen=function(){return this.eventStream.isOpen()},t.prototype.close=function(){this.eventStream.close()},t}(),H=function(){function t(){}return t.TYPE=\"anon-user\",t.DEFAULT_NAME=\"anon-user\",t}(),Y=function(){return function(t,e,r,n){this.authInfo=t,this.providerType=e,this.providerName=r,this.asLink=n}}(),W=r(34);function J(t){var e,r=t.length%4;0!=r?e=t+\"=\".repeat(4-r):e=t;var n=Object(W.toByteArray)(e);return function(t,e,r){var n=\"\",o=\"\";r=Math.min(t.length,r||1/0);for(var i=e=e||0;i<r;i++)t[i]<=127?(n+=X(o)+String.fromCharCode(t[i]),o=\"\"):o+=\"%\"+t[i].toString(16);return n+X(o)}(n,0,n.length)}function z(t){var e;return\"undefined\"==typeof Uint8Array&&(e=Z(t)),e=new Uint8Array(Z(t)),Object(W.fromByteArray)(e)}function Z(t){for(var e,r=1/0,n=t.length,o=null,i=[],s=0;s<n;s++){if((e=t.charCodeAt(s))>55295&&e<57344){if(!o){if(e>56319){(r-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(r-=3)>-1&&i.push(239,191,189);continue}o=e;continue}if(e<56320){(r-=3)>-1&&i.push(239,191,189),o=e;continue}e=o-55296<<10|e-56320|65536,o=null}else o&&((r-=3)>-1&&i.push(239,191,189),o=null);if(e<128){if((r-=1)<0)break;i.push(e)}else if(e<2048){if((r-=2)<0)break;i.push(e>>6|192,63&e|128)}else if(e<65536){if((r-=3)<0)break;i.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<2097152))throw new Error(\"Invalid code point\");if((r-=4)<0)break;i.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return i}function X(t){try{return decodeURIComponent(t)}catch(t){return String.fromCharCode(65533)}}var Q,$=function(){function t(t,e){this.expires=t,this.issuedAt=e}return t.fromEncoded=function(e){var r=t.splitToken(e),n=JSON.parse(J(r[1]));return new t(n.exp,n.iat)},t.splitToken=function(t){var e=t.split(\".\");if(3!==e.length)throw new Error(\"Malformed JWT token. The string \"+t+\" should have 3 parts.\");return e},t}(),tt=function(){function t(t){this.auth=t}return t.prototype.shouldRefresh=function(){var t=this.auth;if(void 0===t)return!1;if(!t.isLoggedIn)return!1;var e,r=t.authInfo;if(void 0===r)return!1;if(!r.isLoggedIn)return!1;try{e=$.fromEncoded(r.accessToken)}catch(t){return console.log(t),!1}return!(Date.now()/1e3<e.expires-300)},t.prototype.run=function(){var t=this;this.shouldRefresh()?this.auth.refreshAccessToken().then(function(){t.nextTimeout=setTimeout(function(){return t.run()},6e4)}).catch(function(){t.nextTimeout=setTimeout(function(){return t.run()},6e4)}):this.nextTimeout=setTimeout(function(){return t.run()},6e4)},t.prototype.stop=function(){clearTimeout(this.nextTimeout)},t}(),et=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(t){t.USER_ID=\"user_id\",t.DEVICE_ID=\"device_id\",t.ACCESS_TOKEN=\"access_token\",t.REFRESH_TOKEN=\"refresh_token\"}(Q||(Q={}));var rt,nt=function(t){function e(e,r,n,o){return t.call(this,e,r,n,o)||this}return et(e,t),e.fromJSON=function(t){return new e(t[Q.USER_ID],t[Q.DEVICE_ID],t[Q.ACCESS_TOKEN],t[Q.REFRESH_TOKEN])},e.prototype.toJSON=function(){var t;return(t={})[Q.USER_ID]=this.userId,t[Q.DEVICE_ID]=this.deviceId,t[Q.ACCESS_TOKEN]=this.accessToken,t[Q.REFRESH_TOKEN]=this.refreshToken,t},e}(s),ot=function(){function t(){}return t.keyPresent=function(t,e){if(void 0===e[t])throw new Error(\"expected \"+t+\" to be present\")},t}(),it=function(){function t(t,e,r){void 0===e&&(e={}),void 0===r&&(r=[]),this.userType=t,this.data=e,this.identities=r}return t.empty=function(){return new t},Object.defineProperty(t.prototype,\"name\",{get:function(){return this.data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"email\",{get:function(){return this.data.email},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"pictureUrl\",{get:function(){return this.data.picture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"firstName\",{get:function(){return this.data.first_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"lastName\",{get:function(){return this.data.last_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"gender\",{get:function(){return this.data.gender},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"birthday\",{get:function(){return this.data.birthday},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"minAge\",{get:function(){var t=this.data.min_age;if(void 0!==t)return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"maxAge\",{get:function(){var t=this.data.max_age;if(void 0!==t)return t},enumerable:!0,configurable:!0}),t}(),st=function(){return function(t,e){this.id=t,this.providerType=e}}(),ut=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(t){t.ID=\"id\",t.PROVIDER_TYPE=\"provider_type\"}(rt||(rt={}));var at,ct=function(t){function e(e,r){return t.call(this,e,r)||this}return ut(e,t),e.fromJSON=function(t){return new e(t[rt.ID],t[rt.PROVIDER_TYPE])},e.prototype.toJSON=function(){var t;return(t={})[rt.ID]=this.id,t[rt.PROVIDER_TYPE]=this.providerType,t},e}(st),ht=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(t){t.DATA=\"data\",t.USER_TYPE=\"type\",t.IDENTITIES=\"identities\"}(at||(at={}));var dt,ft=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return ht(e,t),e.fromJSON=function(t){return ot.keyPresent(at.USER_TYPE,t),ot.keyPresent(at.DATA,t),ot.keyPresent(at.IDENTITIES,t),new e(t[at.USER_TYPE],t[at.DATA],t[at.IDENTITIES].map(ct.fromJSON))},e.prototype.toJSON=function(){var t;return(t={})[at.DATA]=this.data,t[at.USER_TYPE]=this.userType,t[at.IDENTITIES]=this.identities,t},e}(it),pt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(t){t.ID=\"id\",t.PROVIDER_TYPE=\"provider_type\"}(dt||(dt={}));var lt,vt=function(t){function e(e,r){return t.call(this,e,r)||this}return pt(e,t),e.decode=function(t){return new e(t[dt.ID],t[dt.PROVIDER_TYPE])},e.prototype.encode=function(){var t;return(t={})[dt.ID]=this.id,t[dt.PROVIDER_TYPE]=this.providerType,t},e}(st),yt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(t){t.DATA=\"data\",t.USER_TYPE=\"type\",t.IDENTITIES=\"identities\"}(lt||(lt={}));var Et,At=function(t){function e(e,r,n){var o=t.call(this,e,r,n)||this;return o.userType=e,o.data=r,o.identities=n,o}return yt(e,t),e.decode=function(t){return t?new e(t[lt.USER_TYPE],t[lt.DATA],t[lt.IDENTITIES].map(function(t){return vt.decode(t)})):void 0},e.prototype.encode=function(){var t;return(t={})[lt.DATA]=this.data,t[lt.USER_TYPE]=this.userType,t[lt.IDENTITIES]=this.identities.map(function(t){return t.encode()}),t},e}(it),mt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function gt(t,e){if(t.isEmpty)e.remove(Tt.ACTIVE_USER_STORAGE_NAME);else{var r=new Tt(t.userId,t.deviceId,t.accessToken,t.refreshToken,t.loggedInProviderType,t.loggedInProviderName,t.lastAuthActivity,t.userProfile?new At(t.userProfile.userType,t.userProfile.data,t.userProfile.identities.map(function(t){return new vt(t.id,t.providerType)})):void 0);e.set(Tt.ACTIVE_USER_STORAGE_NAME,JSON.stringify(r.encode()))}}function Rt(t,e){var r=[];t.forEach(function(t,e){var n=new Tt(e,t.deviceId,t.accessToken,t.refreshToken,t.loggedInProviderType,t.loggedInProviderName,t.lastAuthActivity,t.userProfile?new At(t.userProfile.userType,t.userProfile.data,t.userProfile.identities.map(function(t){return new vt(t.id,t.providerType)})):void 0);r.push(n.encode())}),e.set(Tt.ALL_USERS_STORAGE_NAME,JSON.stringify(r))}!function(t){t.USER_ID=\"user_id\",t.DEVICE_ID=\"device_id\",t.ACCESS_TOKEN=\"access_token\",t.REFRESH_TOKEN=\"refresh_token\",t.LAST_AUTH_ACTIVITY=\"last_auth_activity\",t.LOGGED_IN_PROVIDER_TYPE=\"logged_in_provider_type\",t.LOGGED_IN_PROVIDER_NAME=\"logged_in_provider_name\",t.USER_PROFILE=\"user_profile\"}(Et||(Et={}));var It,Tt=function(t){function e(e,r,n,o,i,s,u,a){var c=t.call(this,e,r,n,o,i,s,u,a)||this;return c.userProfile=a,c}return mt(e,t),e.decode=function(t){var r=t[Et.USER_ID],n=t[Et.DEVICE_ID],o=t[Et.ACCESS_TOKEN],i=t[Et.REFRESH_TOKEN],s=t[Et.LOGGED_IN_PROVIDER_TYPE],u=t[Et.LOGGED_IN_PROVIDER_NAME],a=t[Et.USER_PROFILE],c=t[Et.LAST_AUTH_ACTIVITY];return new e(r,n,o,i,s,u,new Date(c),At.decode(a))},e.prototype.encode=function(){var t={};return t[Et.USER_ID]=this.userId,t[Et.ACCESS_TOKEN]=this.accessToken,t[Et.REFRESH_TOKEN]=this.refreshToken,t[Et.DEVICE_ID]=this.deviceId,t[Et.LOGGED_IN_PROVIDER_NAME]=this.loggedInProviderName,t[Et.LOGGED_IN_PROVIDER_TYPE]=this.loggedInProviderType,t[Et.LAST_AUTH_ACTIVITY]=this.lastAuthActivity?this.lastAuthActivity.getTime():void 0,t[Et.USER_PROFILE]=this.userProfile?this.userProfile.encode():void 0,t},e.ACTIVE_USER_STORAGE_NAME=\"auth_info\",e.ALL_USERS_STORAGE_NAME=\"all_auth_infos\",e}(s),wt=function(t){var e=\"function\"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},_t=function(t,e){var r=\"function\"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},Nt=function(){function t(t,e,r,n){var o,i;void 0===n&&(n=!0),this.requestClient=t,this.authRoutes=e,this.storage=r;try{o=function(t){var e=t.get(Tt.ALL_USERS_STORAGE_NAME);if(!e)return new Map;var r=JSON.parse(e);if(!Array.isArray(r))throw new V(L.CouldNotLoadPersistedAuthInfo);var n=new Map;return r.forEach(function(t){var e=Tt.decode(t);n.set(e.userId,e)}),n}(r)}catch(t){throw new V(L.CouldNotLoadPersistedAuthInfo)}this.allUsersAuthInfo=o;try{i=function(t){var e=t.get(Tt.ACTIVE_USER_STORAGE_NAME);if(e)return Tt.decode(JSON.parse(e))}(r)}catch(t){throw new V(L.CouldNotLoadPersistedAuthInfo)}this.activeUserAuthInfo=void 0===i?s.empty():i,this.activeUserAuthInfo.hasUser&&(this.currentUser=this.prepUser(this.activeUserAuthInfo)),n&&(this.accessTokenRefresher=new tt(this),this.accessTokenRefresher.run())}return Object.defineProperty(t.prototype,\"authInfo\",{get:function(){return this.activeUserAuthInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"isLoggedIn\",{get:function(){return void 0!==this.currentUser&&this.currentUser.isLoggedIn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"user\",{get:function(){return this.currentUser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"hasDeviceId\",{get:function(){return void 0!==this.activeUserAuthInfo.deviceId&&\"\"!==this.activeUserAuthInfo.deviceId&&\"000000000000000000000000\"!==this.activeUserAuthInfo.deviceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"deviceId\",{get:function(){if(this.hasDeviceId)return this.activeUserAuthInfo.deviceId},enumerable:!0,configurable:!0}),t.prototype.listUsers=function(){var t=this,e=[];return this.allUsersAuthInfo.forEach(function(r){e.push(t.prepUser(r))}),e},t.prototype.doAuthenticatedRequest=function(t,e){var r=this;return this.requestClient.doRequest(this.prepareAuthRequest(t,e||this.activeUserAuthInfo)).catch(function(e){return r.handleAuthFailure(e,t)})},t.prototype.doAuthenticatedRequestWithDecoder=function(t,e){return this.doAuthenticatedRequest(t).then(function(t){var r=o.a.parse(t.body,{strict:!1});return e?e.decode(r):r}).catch(function(t){throw w(t)})},t.prototype.openAuthenticatedEventStream=function(t,e){var r=this;if(void 0===e&&(e=!0),!this.isLoggedIn)throw new V(L.MustAuthenticateFirst);var n=t.useRefreshToken?this.activeUserAuthInfo.refreshToken:this.activeUserAuthInfo.accessToken;return this.requestClient.doStreamRequest(t.builder.withPath(t.path+\"&stitch_at=\"+n).build(),e,function(){return r.openAuthenticatedEventStream(t,!1)}).catch(function(n){return r.handleAuthFailureForEventStream(n,t,e)})},t.prototype.openAuthenticatedStreamWithDecoder=function(t,e){return this.openAuthenticatedEventStream(t).then(function(t){return new G(t,e)})},t.prototype.refreshAccessToken=function(){var t=this,e=(new S.Builder).withRefreshToken().withPath(this.authRoutes.sessionRoute).withMethod(N.POST);return this.doAuthenticatedRequest(e.build()).then(function(e){try{var r=nt.fromJSON(JSON.parse(e.body));t.activeUserAuthInfo=t.activeUserAuthInfo.merge(r)}catch(t){throw new v(t,h.DECODING_ERROR)}try{gt(t.activeUserAuthInfo,t.storage),t.allUsersAuthInfo.set(t.activeUserAuthInfo.userId,t.activeUserAuthInfo),Rt(t.allUsersAuthInfo,t.storage)}catch(t){throw new V(L.CouldNotPersistAuthInfo)}})},t.prototype.switchToUserWithId=function(t){var e=this.allUsersAuthInfo.get(t);if(void 0===e)throw new V(L.UserNotFound);if(!e.isLoggedIn)throw new V(L.UserNotLoggedIn);this.activeUserAuthInfo.hasUser&&this.allUsersAuthInfo.set(this.activeUserAuthInfo.userId,this.activeUserAuthInfo.withNewAuthActivityTime());var r=e.withNewAuthActivityTime();this.allUsersAuthInfo.set(t,r),gt(r,this.storage),this.activeUserAuthInfo=r;var o=this.currentUser;return this.currentUser=this.prepUser(r),this.onAuthEvent(),this.dispatchAuthEvent({currentActiveUser:this.currentUser,kind:n.ActiveUserChanged,previousActiveUser:o}),this.currentUser},t.prototype.loginWithCredentialInternal=function(t){var e,r;if(t instanceof Y)return this.processLogin(t,t.authInfo,t.asLink);if(t.providerCapabilities.reusesExistingSession)try{for(var n=wt(this.allUsersAuthInfo),o=n.next();!o.done;o=n.next()){var i=_t(o.value,2),s=i[0];if(i[1].loggedInProviderType===t.providerType)try{return Promise.resolve(this.switchToUserWithId(s))}catch(t){return Promise.reject(t)}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return this.doLogin(t,!1)},t.prototype.linkUserWithCredentialInternal=function(t,e){return void 0!==this.currentUser&&t.id!==this.currentUser.id?Promise.reject(new V(L.UserNoLongerValid)):this.doLogin(e,!0)},t.prototype.logoutInternal=function(){return this.isLoggedIn&&this.currentUser?this.logoutUserWithIdInternal(this.currentUser.id):Promise.resolve()},t.prototype.logoutUserWithIdInternal=function(t){var e=this,r=this.allUsersAuthInfo.get(t);if(void 0===r)return Promise.reject(new V(L.UserNotFound));if(!r.isLoggedIn)return Promise.resolve();var n=function(){e.clearUserAuthTokens(r.userId),r.loggedInProviderType===H.TYPE&&e.removeUserWithIdInternal(r.userId)};return this.doLogout(r).then(function(){n()}).catch(function(){n()})},t.prototype.removeUserInternal=function(){return this.isLoggedIn&&void 0!==this.currentUser?this.removeUserWithIdInternal(this.currentUser.id):Promise.resolve()},t.prototype.removeUserWithIdInternal=function(t){var e=this,r=this.allUsersAuthInfo.get(t);if(void 0===r)return Promise.reject(new V(L.UserNotFound));var o=function(){e.clearUserAuthTokens(r.userId),e.allUsersAuthInfo.delete(t),Rt(e.allUsersAuthInfo,e.storage);var o=e.prepUser(r.loggedOut());e.onAuthEvent(),e.dispatchAuthEvent({kind:n.UserRemoved,removedUser:o})};return r.isLoggedIn?this.doLogout(r).then(function(){o()}).catch(function(t){o()}):(o(),Promise.resolve())},t.prototype.close=function(){this.accessTokenRefresher&&this.accessTokenRefresher.stop()},t.prototype.prepareAuthRequest=function(t,e){if(!e.isLoggedIn)throw new V(L.MustAuthenticateFirst);var r=t.builder,n=r.headers||{};return t.useRefreshToken?n[T.AUTHORIZATION]=T.getAuthorizationBearer(e.refreshToken):n[T.AUTHORIZATION]=T.getAuthorizationBearer(e.accessToken),r.withHeaders(n),r.build()},t.prototype.handleAuthFailureForEventStream=function(t,e,r){var n=this;if(void 0===r&&(r=!0),!(t instanceof R)||t.errorCode!==f.InvalidSession)throw t;if(e.useRefreshToken||!e.shouldRefreshOnFailure)throw this.clearActiveUserAuth(),t;return this.tryRefreshAccessToken(e.startedAt).then(function(){return n.openAuthenticatedEventStream(e.builder.withShouldRefreshOnFailure(!1).build(),r)})},t.prototype.handleAuthFailure=function(t,e){var r=this;if(!(t instanceof R)||t.errorCode!==f.InvalidSession)throw t;if(e.useRefreshToken||!e.shouldRefreshOnFailure)throw this.clearActiveUserAuth(),t;return this.tryRefreshAccessToken(e.startedAt).then(function(){return r.doAuthenticatedRequest(e.builder.withShouldRefreshOnFailure(!1).build())})},t.prototype.tryRefreshAccessToken=function(t){if(!this.isLoggedIn)throw new V(L.LoggedOutDuringRequest);try{if($.fromEncoded(this.activeUserAuthInfo.accessToken).issuedAt>=t)return Promise.resolve()}catch(t){}return this.refreshAccessToken()},t.prototype.prepUser=function(t){return this.userFactory.makeUser(t.userId,t.loggedInProviderType,t.loggedInProviderName,t.isLoggedIn,t.lastAuthActivity,t.userProfile)},t.prototype.attachAuthOptions=function(t){var e={};e.device=this.deviceInfo,t.options=e},t.prototype.doLogin=function(t,e){var r=this,o=this.currentUser;return this.doLoginRequest(t,e).then(function(n){return r.processLoginResponse(t,n,e)}).then(function(t){return r.onAuthEvent(),e?r.dispatchAuthEvent({kind:n.UserLinked,linkedUser:t}):(r.dispatchAuthEvent({kind:n.UserLoggedIn,loggedInUser:t}),r.dispatchAuthEvent({currentActiveUser:t,kind:n.ActiveUserChanged,previousActiveUser:o})),t})},t.prototype.doLoginRequest=function(t,e){var r=new M.Builder;r.withMethod(N.POST),e?r.withPath(this.authRoutes.getAuthProviderLinkRoute(t.providerName)):r.withPath(this.authRoutes.getAuthProviderLoginRoute(t.providerName));var n=t.material;if(this.attachAuthOptions(n),r.withDocument(n),!e)return this.requestClient.doRequest(r.build());var o=new C(r.build(),r.document);return this.doAuthenticatedRequest(o)},t.prototype.processLogin=function(t,e,r){var o=this,i=this.activeUserAuthInfo,u=this.currentUser;return e=this.activeUserAuthInfo.merge(new s(e.userId,e.deviceId,e.accessToken,e.refreshToken,t.providerType,t.providerName,void 0,void 0)),this.activeUserAuthInfo=e,this.currentUser=this.userFactory.makeUser(this.activeUserAuthInfo.userId,t.providerType,t.providerName,this.activeUserAuthInfo.isLoggedIn,new Date,void 0),this.doGetUserProfile().then(function(r){i.hasUser&&o.allUsersAuthInfo.set(i.userId,i.withNewAuthActivityTime()),e=e.merge(new s(e.userId,e.deviceId,e.accessToken,e.refreshToken,t.providerType,t.providerName,new Date,r));var a=!o.allUsersAuthInfo.has(e.userId);try{gt(e,o.storage),o.allUsersAuthInfo.set(e.userId,e),Rt(o.allUsersAuthInfo,o.storage)}catch(t){throw o.activeUserAuthInfo=i,o.currentUser=u,e.userId!==i.userId&&e.userId&&o.allUsersAuthInfo.delete(e.userId),new V(L.CouldNotPersistAuthInfo)}return o.activeUserAuthInfo=e,o.currentUser=o.userFactory.makeUser(o.activeUserAuthInfo.userId,t.providerType,t.providerName,o.activeUserAuthInfo.isLoggedIn,o.activeUserAuthInfo.lastAuthActivity,r),a&&(o.onAuthEvent(),o.dispatchAuthEvent({addedUser:o.currentUser,kind:n.UserAdded})),o.currentUser}).catch(function(t){if(t instanceof V)throw t;if(r||i.hasUser){var e=o.activeUserAuthInfo;o.activeUserAuthInfo=i,o.currentUser=u,r&&(o.activeUserAuthInfo=o.activeUserAuthInfo.withAuthProvider(e.loggedInProviderType,e.loggedInProviderName))}else o.clearActiveUserAuth();throw t})},t.prototype.processLoginResponse=function(t,e,r){try{if(!e)throw new R(\"the login response could not be processed for credential: \"+t+\";response was undefined\");if(!e.body)throw new R(\"response with status code \"+e.statusCode+\" has empty body\");return this.processLogin(t,nt.fromJSON(JSON.parse(e.body)),r)}catch(t){throw new v(t,h.DECODING_ERROR)}},t.prototype.doGetUserProfile=function(){var t=new S.Builder;return t.withMethod(N.GET).withPath(this.authRoutes.profileRoute),this.doAuthenticatedRequest(t.build()).then(function(t){return ft.fromJSON(JSON.parse(t.body))}).catch(function(t){throw t instanceof d?t:new v(t,h.DECODING_ERROR)})},t.prototype.doLogout=function(t){var e=new S.Builder;return e.withRefreshToken().withPath(this.authRoutes.sessionRoute).withMethod(N.DELETE),this.doAuthenticatedRequest(e.build(),t).then(function(){})},t.prototype.clearActiveUserAuth=function(){this.isLoggedIn&&this.clearUserAuthTokens(this.activeUserAuthInfo.userId)},t.prototype.clearUserAuthTokens=function(t){var e=this.allUsersAuthInfo.get(t);if(void 0===e){if(this.activeUserAuthInfo.userId!==t)throw new V(L.UserNotFound)}else if(!e.isLoggedIn)return;try{var r=void 0;if(e){var o=e.loggedOut();this.allUsersAuthInfo.set(t,o),Rt(this.allUsersAuthInfo,this.storage),r=this.userFactory.makeUser(o.userId,o.loggedInProviderType,o.loggedInProviderName,o.isLoggedIn,o.lastAuthActivity,o.userProfile)}var i=!1;this.activeUserAuthInfo.hasUser&&this.activeUserAuthInfo.userId===t&&(i=!0,this.activeUserAuthInfo=this.activeUserAuthInfo.withClearedUser(),this.currentUser=void 0,gt(this.activeUserAuthInfo,this.storage)),r&&(this.onAuthEvent(),this.dispatchAuthEvent({kind:n.UserLoggedOut,loggedOutUser:r}),i&&this.dispatchAuthEvent({currentActiveUser:void 0,kind:n.ActiveUserChanged,previousActiveUser:r}))}catch(t){throw new V(L.CouldNotPersistAuthInfo)}},t}(),Ot=function(){function t(t,e,r,n,o,i){this.id=t,this.loggedInProviderType=e,this.loggedInProviderName=r,this.profile=void 0===i?it.empty():i,this.isLoggedIn=n,this.lastAuthActivity=o}return Object.defineProperty(t.prototype,\"userType\",{get:function(){return this.profile.userType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"identities\",{get:function(){return this.profile.identities},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return this.id===t.id&&JSON.stringify(this.identities)===JSON.stringify(t.identities)&&this.isLoggedIn===t.isLoggedIn&&this.loggedInProviderName===t.loggedInProviderName&&this.loggedInProviderType===t.loggedInProviderType&&JSON.stringify(this.profile)===JSON.stringify(t.profile)},t}();!function(t){t.DEVICE_ID=\"deviceId\",t.APP_ID=\"appId\",t.APP_VERSION=\"appVersion\",t.PLATFORM=\"platform\",t.PLATFORM_VERSION=\"platformVersion\",t.SDK_VERSION=\"sdkVersion\"}(It||(It={}));var Pt,bt=It,Ut=function(){return function(t){void 0===t&&(t=!1),this.reusesExistingSession=t}}(),St=function(){return function(t){void 0===t&&(t=H.DEFAULT_NAME),this.providerType=H.TYPE,this.material={},this.providerCapabilities=new Ut(!0),this.providerName=t}}(),Dt=function(){function t(){}return t.TYPE=\"custom-token\",t.DEFAULT_NAME=\"custom-token\",t}();(Pt||(Pt={})).TOKEN=\"token\";var Ct,kt=function(){function t(){}return t.TYPE=\"oauth2-facebook\",t.DEFAULT_NAME=\"oauth2-facebook\",t}();(Ct||(Ct={})).ACCESS_TOKEN=\"accessToken\";!function(){function t(t,e){var r;void 0===e&&(e=kt.DEFAULT_NAME),this.providerType=kt.TYPE,this.providerName=e,this.accessToken=t,this.material=((r={})[Ct.ACCESS_TOKEN]=this.accessToken,r)}Object.defineProperty(t.prototype,\"providerCapabilities\",{get:function(){return new Ut(!1)},enumerable:!0,configurable:!0})}();var Lt,Ft=function(){function t(){}return t.TYPE=\"oauth2-google\",t.DEFAULT_NAME=\"oauth2-google\",t}();(Lt||(Lt={})).AUTH_CODE=\"authCode\";var Mt,xt=function(){function t(){}return t.TYPE=\"api-key\",t.DEFAULT_NAME=\"api-key\",t}();(Mt||(Mt={})).KEY=\"key\";var jt,qt=function(){return function(t,e,r){this.providerName=t,this.requestClient=e,this.baseRoute=r}}();!function(t){t.ID=\"_id\",t.KEY=\"key\",t.NAME=\"name\",t.DISABLED=\"disabled\"}(jt||(jt={}));var Vt,Bt=function(){function t(t,e,r,n){this.id=o.b.ObjectID.createFromHexString(t),this.key=e,this.name=r,this.disabled=n}return t.readFromApi=function(e){var r=\"string\"==typeof e?JSON.parse(e):e;return ot.keyPresent(jt.ID,r),ot.keyPresent(jt.NAME,r),ot.keyPresent(jt.DISABLED,r),new t(r[jt.ID],r[jt.KEY],r[jt.NAME],r[jt.DISABLED])},t.prototype.toJSON=function(){var t;return(t={})[jt.ID]=this.id,t[jt.KEY]=this.key,t[jt.NAME]=this.name,t[jt.DISABLED]=this.disabled,t},t}(),Kt=function(){function t(){}return t.TYPE=\"api-key\",t.DEFAULT_NAME=\"api-key\",t}(),Gt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(t){t.NAME=\"name\"}(Vt||(Vt={}));var Ht,Yt=function(t){function e(e,r){var n=r.baseAuthRoute+\"/api_keys\",o=Kt.DEFAULT_NAME;return t.call(this,o,e,n)||this}return Gt(e,t),e.prototype.createApiKey=function(t){var e,r=new C.Builder;return r.withMethod(N.POST).withPath(this.baseRoute).withDocument((e={},e[Vt.NAME]=t,e)).withRefreshToken(),this.requestClient.doAuthenticatedRequest(r.build()).then(function(t){return Bt.readFromApi(t.body)}).catch(function(t){throw w(t)})},e.prototype.fetchApiKey=function(t){var e=new S.Builder;return e.withMethod(N.GET).withPath(this.getApiKeyRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then(function(t){return Bt.readFromApi(t.body)}).catch(function(t){throw w(t)})},e.prototype.fetchApiKeys=function(){var t=new S.Builder;return t.withMethod(N.GET).withPath(this.baseRoute),t.withRefreshToken(),this.requestClient.doAuthenticatedRequest(t.build()).then(function(t){var e=JSON.parse(t.body);if(Array.isArray(e))return e.map(function(t){return Bt.readFromApi(t)});throw new v(new Error(\"unexpected non-array response from server\"),h.DECODING_ERROR)}).catch(function(t){throw w(t)})},e.prototype.deleteApiKey=function(t){var e=new S.Builder;return e.withMethod(N.DELETE).withPath(this.getApiKeyRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then(function(){})},e.prototype.enableApiKey=function(t){var e=new S.Builder;return e.withMethod(N.PUT).withPath(this.getApiKeyEnableRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then(function(){})},e.prototype.disableApiKey=function(t){var e=new S.Builder;return e.withMethod(N.PUT).withPath(this.getApiKeyDisableRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then(function(){})},e.prototype.getApiKeyRoute=function(t){return this.baseRoute+\"/\"+t},e.prototype.getApiKeyEnableRoute=function(t){return this.getApiKeyRoute(t)+\"/enable\"},e.prototype.getApiKeyDisableRoute=function(t){return this.getApiKeyRoute(t)+\"/disable\"},e}(qt);(Ht||(Ht={})).KEY=\"key\";var Wt,Jt,zt=function(){function t(){}return t.TYPE=\"local-userpass\",t.DEFAULT_NAME=\"local-userpass\",t}(),Zt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(t){t.EMAIL=\"email\",t.PASSWORD=\"password\"}(Wt||(Wt={})),function(t){t.EMAIL=\"email\",t.PASSWORD=\"password\",t.TOKEN=\"token\",t.TOKEN_ID=\"tokenId\"}(Jt||(Jt={}));var Xt,Qt=function(t){function e(e,r,n){void 0===e&&(e=zt.DEFAULT_NAME);var o=n.getAuthProviderRoute(e);return t.call(this,e,r,o)||this}return Zt(e,t),e.prototype.registerWithEmailInternal=function(t,e){var r,n=new M.Builder;return n.withMethod(N.POST).withPath(this.getRegisterWithEmailRoute()),n.withDocument(((r={})[Wt.EMAIL]=t,r[Wt.PASSWORD]=e,r)),this.requestClient.doRequest(n.build()).then(function(){})},e.prototype.confirmUserInternal=function(t,e){var r,n=new M.Builder;return n.withMethod(N.POST).withPath(this.getConfirmUserRoute()),n.withDocument(((r={})[Jt.TOKEN]=t,r[Jt.TOKEN_ID]=e,r)),this.requestClient.doRequest(n.build()).then(function(){})},e.prototype.resendConfirmationEmailInternal=function(t){var e,r=new M.Builder;return r.withMethod(N.POST).withPath(this.getResendConfirmationEmailRoute()),r.withDocument(((e={})[Jt.EMAIL]=t,e)),this.requestClient.doRequest(r.build()).then(function(){})},e.prototype.resetPasswordInternal=function(t,e,r){var n,o=new M.Builder;return o.withMethod(N.POST).withPath(this.getResetPasswordRoute()),o.withDocument(((n={})[Jt.TOKEN]=t,n[Jt.TOKEN_ID]=e,n[Jt.PASSWORD]=r,n)),this.requestClient.doRequest(o.build()).then(function(){})},e.prototype.sendResetPasswordEmailInternal=function(t){var e,r=new M.Builder;return r.withMethod(N.POST).withPath(this.getSendResetPasswordEmailRoute()),r.withDocument(((e={})[Jt.EMAIL]=t,e)),this.requestClient.doRequest(r.build()).then(function(){})},e.prototype.getRegisterWithEmailRoute=function(){return this.getExtensionRoute(\"register\")},e.prototype.getConfirmUserRoute=function(){return this.getExtensionRoute(\"confirm\")},e.prototype.getResendConfirmationEmailRoute=function(){return this.getExtensionRoute(\"confirm/send\")},e.prototype.getResetPasswordRoute=function(){return this.getExtensionRoute(\"reset\")},e.prototype.getSendResetPasswordEmailRoute=function(){return this.getExtensionRoute(\"reset/send\")},e.prototype.getExtensionRoute=function(t){return this.baseRoute+\"/\"+t},e}(qt);!function(t){t.USERNAME=\"username\",t.PASSWORD=\"password\"}(Xt||(Xt={}));var $t,te=function(){return function(t,e,r){var n;void 0===r&&(r=zt.DEFAULT_NAME),this.username=t,this.password=e,this.providerName=r,this.providerType=zt.TYPE,this.providerCapabilities=new Ut(!1),this.material=((n={})[Xt.USERNAME]=this.username,n[Xt.PASSWORD]=this.password,n)}}();!function(t){t.Normal=\"normal\",t.Server=\"server\",t.Unknown=\"unknown\"}($t||($t={}));!function(){function t(t){this.suiteName=t,this.storage={}}t.prototype.get=function(t){return this.storage[this.suiteName+\".\"+t]},t.prototype.set=function(t,e){this.storage[this.suiteName+\".\"+t]=e},t.prototype.remove=function(t){delete this.storage[this.suiteName+\".\"+t]}}();var ee,re=function(){return function(){}}();!function(t){t[t.AUTH_EVENT=0]=\"AUTH_EVENT\"}(ee||(ee={}));var ne=function(){function t(t,e,r){this.serviceField=\"service\",this.argumentsField=\"arguments\",this.requestClient=t,this.serviceRoutes=e,this.serviceName=r,this.serviceBinders=[],this.allocatedStreams=[]}return t.prototype.callFunction=function(t,e,r){return this.requestClient.doAuthenticatedRequestWithDecoder(this.getCallServiceFunctionRequest(t,e),r)},t.prototype.streamFunction=function(t,e,r){var n=this;return this.requestClient.openAuthenticatedStreamWithDecoder(this.getStreamServiceFunctionRequest(t,e),r).then(function(t){return n.allocatedStreams.push(t),t})},t.prototype.bind=function(t){this.serviceBinders.push(t)},t.prototype.onRebindEvent=function(t){switch(t.type){case ee.AUTH_EVENT:t.event.kind===n.ActiveUserChanged&&this.closeAllocatedStreams()}this.serviceBinders.forEach(function(e){e.onRebindEvent(t)})},t.prototype.getStreamServiceFunctionRequest=function(t,e){var r={name:t};void 0!==this.serviceName&&(r[this.serviceField]=this.serviceName),r[this.argumentsField]=e;var n=new S.Builder;return n.withMethod(N.GET).withPath(this.serviceRoutes.functionCallRoute+\"?stitch_request=\"+encodeURIComponent(z(o.a.stringify(r)))),n.build()},t.prototype.getCallServiceFunctionRequest=function(t,e){var r={name:t};void 0!==this.serviceName&&(r[this.serviceField]=this.serviceName),r[this.argumentsField]=e;var n=new C.Builder;return n.withMethod(N.POST).withPath(this.serviceRoutes.functionCallRoute),n.withDocument(r),n.build()},t.prototype.closeAllocatedStreams=function(){this.allocatedStreams.forEach(function(t){t.isOpen()&&t.close()}),this.allocatedStreams=[]},t}(),oe=function(){function t(t,e){this.functionService=new ne(t,e.serviceRoutes)}return t.prototype.callFunction=function(t,e,r){return this.functionService.callFunction(t,e,r)},t}(),ie=function(t){var e=\"function\"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},se=function(){function t(t){this.reconnecter=t,this.closed=!1,this.events=[],this.listeners=[],this.lastErr=void 0}return t.prototype.isOpen=function(){return!this.closed},t.prototype.addListener=function(t){var e=this;this.closed?setTimeout(function(){return t.onEvent(new B(K.ERROR_EVENT_NAME,\"stream closed\"))},0):void 0===this.lastErr?(this.listeners.push(t),this.poll()):setTimeout(function(){return t.onEvent(new B(K.ERROR_EVENT_NAME,e.lastErr))},0)},t.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)},t.prototype.nextEvent=function(){var t=this;return this.closed?Promise.reject(new B(K.ERROR_EVENT_NAME,\"stream closed\")):void 0!==this.lastErr?Promise.reject(new B(K.ERROR_EVENT_NAME,this.lastErr)):new Promise(function(e,r){t.listenOnce({onEvent:function(t){e(t)}})})},t.prototype.close=function(){this.closed||(this.closed=!0,this.afterClose())},t.prototype.reconnect=function(e){var r=this;this.reconnecter?this.reconnecter().then(function(t){r.onReconnect(t)}).catch(function(n){if(!(n instanceof d&&n instanceof v))return r.closed=!0,r.events.push(new B(K.ERROR_EVENT_NAME,\"stream closed: \"+e)),void r.poll();setTimeout(function(){return r.reconnect(n)},t.RETRY_TIMEOUT_MILLIS)}):this.closed||(this.closed=!0,this.events.push(new B(K.ERROR_EVENT_NAME,\"stream closed: \"+e)),this.poll())},t.prototype.poll=function(){for(var t,e;0!==this.events.length;){var r=this.events.pop();try{for(var n=ie(this.listeners),o=n.next();!o.done;o=n.next()){var i=o.value;i.onEvent&&i.onEvent(r)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}}},t.prototype.listenOnce=function(t){var e=this;if(this.closed)setTimeout(function(){return t.onEvent(new B(K.ERROR_EVENT_NAME,\"stream closed\"))},0);else if(void 0===this.lastErr){var r={onEvent:function(n){e.removeListener(r),t.onEvent(n)}};this.addListener(r)}else setTimeout(function(){return t.onEvent(new B(K.ERROR_EVENT_NAME,e.lastErr))},0)},t.RETRY_TIMEOUT_MILLIS=5e3,t}(),ue=function(){return function(t,e,r,n){this.method=t,this.url=e,this.headers=r,this.body=n}}();!function(t){var e=function(){function e(t){t&&(this.method=t.method,this.url=t.url,this.headers=t.headers,this.body=t.body)}return e.prototype.withMethod=function(t){return this.method=t,this},e.prototype.withUrl=function(t){return this.url=t,this},e.prototype.withHeaders=function(t){return this.headers=t,this},e.prototype.withBody=function(t){return this.body=t,this},e.prototype.build=function(){if(void 0===this.method)throw new Error(\"must set method\");if(void 0===this.url)throw new Error(\"must set non-empty url\");return new t(this.method,this.url,void 0===this.headers?{}:this.headers,this.body)},e}();t.Builder=e}(ue||(ue={}));var ae=function(){return function(t,e,r){var n=this;this.statusCode=e,this.body=r,this.headers={},Object.keys(t).map(function(e,r){n.headers[e.toLocaleLowerCase()]=t[e]})}}(),ce=\"/api/client/v2.0\";function he(t){return ce+\"/app/\"+t}function de(t){return he(t)+\"/functions/call\"}function fe(t,e){return he(t)+\"/auth/providers/\"+e}function pe(t,e){return fe(t,e)+\"/login\"}var le,ve=function(){function t(t){var e=this;this.baseAuthRoute=ce+\"/auth\",this.sessionRoute=e.baseAuthRoute+\"/session\",this.profileRoute=e.baseAuthRoute+\"/profile\",this.clientAppId=t}return t.prototype.getAuthProviderRoute=function(t){return fe(this.clientAppId,t)},t.prototype.getAuthProviderLoginRoute=function(t){return pe(this.clientAppId,t)},t.prototype.getAuthProviderLinkRoute=function(t){return function(t,e){return pe(t,e)+\"?link=true\"}(this.clientAppId,t)},t.prototype.getAuthProviderExtensionRoute=function(t,e){return this.getAuthProviderRoute(t)+\"/\"+e},t}();!function(t){t.DEPLOYMENT_MODEL=\"deployment_model\",t.LOCATION=\"location\",t.HOSTNAME=\"hostname\"}(le||(le={}));var ye=function(){function t(t,e,r){this.deploymentModel=t,this.location=e,this.hostname=r}return t.fromJSON=function(e){return new t(e[le.DEPLOYMENT_MODEL],e[le.LOCATION],e[le.HOSTNAME])},t.prototype.toJSON=function(){var t;return(t={})[le.DEPLOYMENT_MODEL]=this.deploymentModel,t[le.LOCATION]=this.location,t[le.HOSTNAME]=this.hostname,t},t}();var Ee=function(){function t(t,e){this.baseUrl=t,this.transport=e}return t.prototype.doRequestToURL=function(t,e){return this.transport.roundTrip(this.buildRequest(t,e)).catch(function(t){throw new v(t,h.TRANSPORT_ERROR)}).then(function(t){return(e=t).statusCode>=200&&e.statusCode<300?e:_(e);var e})},t.prototype.doStreamRequestToURL=function(t,e,r,n){return void 0===r&&(r=!0),this.transport.stream(this.buildRequest(t,e),r,n).catch(function(t){if(t instanceof d)throw t;throw new v(t,h.TRANSPORT_ERROR)})},t.prototype.buildRequest=function(t,e){return(new ue.Builder).withMethod(t.method).withUrl(\"\"+e+t.path).withHeaders(t.headers).withBody(t.body).build()},t}(),Ae=function(){return function(t){this.clientAppId=t,this.functionCallRoute=de(t)}}(),me=function(){return function(t){this.clientAppId=t,this.authRoutes=new ve(t),this.serviceRoutes=new Ae(t),this.appMetadataRoute=function(t){return he(t)+\"/location\"}(t),this.functionCallRoute=de(t)}}(),ge=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Re=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{a(n.next(t))}catch(t){i(t)}}function u(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,u)}a((n=n.apply(t,e||[])).next())})},Ie=function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Te=function(t){function e(e,r,n){var o=t.call(this,r,n)||this;return o.clientAppId=e,o.routes=new me(e),o}return ge(e,t),e.prototype.doRequest=function(e){var r=this;return this.initAppMetadata().then(function(n){return t.prototype.doRequestToURL.call(r,e,n.hostname)})},e.prototype.doStreamRequest=function(e,r,n){var o=this;return void 0===r&&(r=!0),this.initAppMetadata().then(function(i){return t.prototype.doStreamRequestToURL.call(o,e,i.hostname,r,n)})},e.prototype.getBaseURL=function(){return Re(this,void 0,void 0,function(){return Ie(this,function(t){return[2,this.initAppMetadata().then(function(t){return t.hostname})]})})},e.prototype.initAppMetadata=function(){var e=this;if(this.appMetadata)return Promise.resolve(this.appMetadata);var r=(new O.Builder).withMethod(N.GET).withPath(this.routes.appMetadataRoute).build();return t.prototype.doRequestToURL.call(this,r,this.baseUrl).then(function(t){return e.appMetadata=ye.fromJSON(o.a.parse(t.body)),e.appMetadata})},e}(Ee),we=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_e=(function(t){function e(e,r){return t.call(this,e,r)||this}we(e,t),e.prototype.doRequest=function(e){return t.prototype.doRequestToURL.call(this,e,this.baseUrl)},e.prototype.doStreamRequest=function(e,r,n){return void 0===r&&(r=!0),t.prototype.doStreamRequestToURL.call(this,e,this.baseUrl,r,n)},e.prototype.getBaseURL=function(){return Promise.resolve(this.baseUrl)}}(Ee),function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}()),Ne=function(t){function e(e){var r=t.call(this)||this;return r.type=ee.AUTH_EVENT,r.event=e,r}return _e(e,t),e}(re),Oe=function(){function t(t,e,r,n){this.baseUrl=t,this.storage=e,this.dataDirectory=r,this.transport=n}return t.prototype.builder=function(){return new t.Builder(this)},t}();!function(t){var e=function(){function e(t){t&&(this.baseUrl=t.baseUrl,this.storage=t.storage,this.dataDirectory=t.dataDirectory,this.transport=t.transport)}return e.prototype.withBaseUrl=function(t){return this.baseUrl=t,this},e.prototype.withStorage=function(t){return this.storage=t,this},e.prototype.withDataDirectory=function(t){return this.dataDirectory=t,this},e.prototype.withTransport=function(t){return this.transport=t,this},e.prototype.build=function(){return new t(this.baseUrl,this.storage,this.dataDirectory,this.transport)},e}();t.Builder=e}(Oe||(Oe={}));var Pe=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),be=function(t){function e(e,r,n){var o=t.call(this,e.baseUrl,e.storage,e.dataDirectory,e.transport)||this;return o.localAppVersion=n,o.localAppName=r,o}return Pe(e,t),e.prototype.builder=function(){return new e.Builder(this)},e}(Oe);!function(t){var e=function(e){function r(t){var r=e.call(this,t)||this;return t&&(r.localAppVersion=t.localAppVersion,r.localAppName=t.localAppName),r}return Pe(r,e),r.prototype.withLocalAppName=function(t){return this.localAppName=t,this},r.prototype.withLocalAppVersion=function(t){return this.localAppVersion=t,this},r.prototype.build=function(){var r=e.prototype.build.call(this);return new t(r,this.localAppName,this.localAppVersion)},r}(Oe.Builder);t.Builder=e}(be||(be={}));var Ue=function(){return function(t,e,r,n){this.clientAppId=t,this.dataDirectory=e,this.localAppName=r,this.localAppVersion=n}}();r.d(e,\"f\",function(){return o.b}),r.d(e,\"d\",function(){return s}),r.d(e,\"z\",function(){return Y}),r.d(e,\"a\",function(){return St}),r.d(e,\"q\",function(){return kt}),r.d(e,\"r\",function(){return Ft}),r.d(e,\"C\",function(){return d}),r.d(e,\"A\",function(){return V}),r.d(e,\"B\",function(){return L}),r.d(e,\"m\",function(){return Yt}),r.d(e,\"E\",function(){return zt}),r.d(e,\"F\",function(){return te}),r.d(e,\"n\",function(){return Qt}),r.d(e,\"i\",function(){return oe}),r.d(e,\"j\",function(){return Nt}),r.d(e,\"l\",function(){return Ot}),r.d(e,\"o\",function(){return bt}),r.d(e,\"h\",function(){return I}),r.d(e,\"p\",function(){return B}),r.d(e,\"g\",function(){return se}),r.d(e,\"D\",function(){return K}),r.d(e,\"s\",function(){return T}),r.d(e,\"w\",function(){return Ue}),r.d(e,\"v\",function(){return be}),r.d(e,\"x\",function(){return Te}),r.d(e,\"y\",function(){return me}),r.d(e,\"k\",function(){return ne}),r.d(e,\"u\",function(){return ve}),r.d(e,\"t\",function(){return ae}),r.d(e,\"H\",function(){return _}),r.d(e,\"b\",function(){return ot}),r.d(e,\"c\",function(){return n}),r.d(e,\"e\",function(){return Ne}),r.d(e,\"G\",function(){return z})}}]);"],"mappings":"AAAA","sourceRoot":""}